<html>
	<head>
		<!-- import -->
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<!--Import A-Frame-->
		<script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
		<script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
		<script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-aframe.prod.js"></script>

		<!--Import A-Frame extras-->
		<!-- <script src="node_modules/aframe-extras/dist/aframe-extras.min.js"></script> -->
		<script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@tagOrCommit/dist/aframe-extras.min.js"></script>
		<!--Import Ammo.js physics-->
		<!-- <script src="https://cdn.jsdelivr.net/gh/kripken/ammo.js@42760fd/builds/ammo.wasm.js"></script>
		<script src="http://kripken.github.io/ammo.js/builds/ammo.wasm.js"></script> -->
		<script src="https://cdn.jsdelivr.net/gh/MozillaReality/ammo.js@8bbc0ea/builds/ammo.wasm.js"></script>
		<!-- <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system/dist/aframe-physics-system.min.js"></script> -->

		<!-- Mobile Debugging -->
		<script
			data-consolejs-channel="6e57dd1c-931c-9493-2ec1-6537451d418f"
			src="https://remotejs.com/agent/agent.js"
		></script>
		<!-- A-Frame Physics -->
		<!-- <script src="./dist/aframe-physics-system.js"></script> -->
		<!-- Game Logic -->
		<script src="./game.js"></script>
		<script src="./function.js"></script>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const sceneEl = document.querySelector("a-scene")
				const arSystem = sceneEl.systems["mindar-image-system"]
				const exampleTarget = document.querySelector("#marker")

				// arReady event triggered when ready
				sceneEl.addEventListener("arReady", (event) => {
					console.log("MindAR is ready")
				})
				// arError event triggered when something went wrong. Mostly browser compatbility issue
				sceneEl.addEventListener("arError", (event) => {
					// console.log("MindAR failed to start")
				})
				// detect target found
				exampleTarget.addEventListener("targetFound", (event) => {
					console.log("target found")
					var model = document.querySelector("#skeleton")

					// setTimeout(function () {
					// 	console.log("Executed after 1 second")
					// 	// document.getElementById('skeleton').setAttribute('visible', true);
					// 	document
					// 		.getElementById("temp-skeleton")
					// 		.setAttribute(
					// 			"ammo-body",
					// 			"type: dynamic; emitCollisionEvents: true;"
					// 		)
					// 	const tempSkeleton =
					// 		document.getElementById("temp-skeleton")

					// 	const newSkeleton =
					// 		document.createElement("a-gltf-model")
					// 	newSkeleton.setAttribute("src", "#skelly")
					// 	newSkeleton.setAttribute("class", "clickable")
					// 	newSkeleton.setAttribute("position", "0 0.3 -5")
					// 	newSkeleton.setAttribute("scale", "1 1 1")
					// 	newSkeleton.setAttribute("id", "skeleton")
					// 	newSkeleton.setAttribute(
					// 		"ammo-body",
					// 		"type: dynamic; emitCollisionEvents: true;"
					// 	)
					// 	newSkeleton.setAttribute(
					// 		"ammo-shape",
					// 		"type: box; fit: manual; halfExtents: 0.5 1 0.5;"
					// 	)
					// 	newSkeleton.setAttribute("jump", {})
					// 	tempSkeleton.appendChild(newSkeleton)
					// 	console.log("Skeleton created")
					// }, 1000)
				})

				// document.getElementById('land2').setAttribute('visible', true);
				//     document.getElementById('land2').setAttribute('ammo-body', 'type: static; emitCollisionEvents: true;');

				//     setTimeout(function () {
				//         console.log("Executed after 1 second");
				//         // document.getElementById('skeleton').setAttribute('visible', true);
				//         document.getElementById('temp-skeleton').setAttribute('ammo-body', 'type: dynamic; emitCollisionEvents: true;');
				//         const tempSkeleton = document.getElementById('temp-skeleton');

				//         const newSkeleton = document.createElement('a-gltf-model');
				//         newSkeleton.setAttribute('src', '#skelly');
				//         newSkeleton.setAttribute('class', 'clickable');
				//         newSkeleton.setAttribute('position', '0 0.3 -5');
				//         newSkeleton.setAttribute('scale', '1 1 1');
				//         newSkeleton.setAttribute('id', 'skeleton');
				//         newSkeleton.setAttribute('animation', 'property: position; to: 0 0.1 0.1; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate')
				//         newSkeleton.setAttribute('ammo-body', 'type: dynamic; emitCollisionEvents: true;');
				//         newSkeleton.setAttribute('spirite-jump');
				//         newSkeleton.setAttribute('skeleton-click');
				//         tempSkeleton.appendChild(newSkeleton);
				//         console.log("ammo enabled");
				//     }, 1000);

				// // detect target lost
				exampleTarget.addEventListener("targetLost", (event) => {
					console.log("target lost")
					// const tempSkeleton =
					// 	document.getElementById("temppSkeleton")
				})

				//const tempSkeleton = document.getElementById('temp-skeleton');

				// // document.getElementById('skeleton').setAttribute('visible', false);
				// document.getElementById('temp-skeleton').removeAttribute('ammo-body');
				// document.getElementById('land2').setAttribute('visible', false);
				// document.getElementById('land2').removeAttribute('ammo-body');
				// tempSkeleton.removeChild(tempSkeleton.firstChild);
				// console.log("ammo disabled");
			})
		</script>
	</head>

	<body>
		<!-- <div style="position: absolute; z-index: 1000">
        <button id="example-start-button">Start</button>
        <button id="example-pause-button">Pause</button>
        <button id="example-pause-keep-video-button">Pause (keep video)</button>
        <button id="example-unpause-button">UnPause</button>
        <button id="example-stop-button">Stop</button>
    </div> -->

		<a-scene
			mindar-image="imageTargetSrc: ./assets/easter-marker/targets.mind"
			color-space="sRGB"
			vr-mode-ui="enabled: false"
			physics="driver: ammo; debug: true; debugDrawMode: 1;"
			renderer="colorManagement: true; sortObjects: false; precision: high; logarithmicDepthBuffer: false; physicallyCorrectLights: false;"
		>
			<!-- <a-scene mindar-image="imageTargetSrc: ./assets/easter-marker/targets.mind" color-space="sRGB"
        vr-mode-ui="enabled: false"
        renderer="colorManagement: true; sortObjects: false; precision: high; logarithmicDepthBuffer: false; physicallyCorrectLights: false;"
        device-orientation-permission-ui="enabled: false"> -->
			<a-assets id="assets">
				<img
					id="card"
					src="./assets/easter-marker/GeoAR_Easter_easter_2-01.png"
				/>
				<a-asset-item
					id="bunny"
					src="./assets/3dmodels/Bunny_01.gltf"
				></a-asset-item>
				<a-asset-item
					id="skelly"
					src="./assets/3dmodels/Skeleton.gltf"
				></a-asset-item>

				<a-asset-item
					id="FlyingLand_2"
					src="./assets/easter-island/FlyingLand_2.glb"
				></a-asset-item>
			</a-assets>

			<!-- Add the raycaster component to the scene to enable mouse events on entities -->
			<a-camera
				position="0 0 0"
				look-controls="enabled: false"
				cursor="fuse: false; rayOrigin: mouse;"
				raycaster="far: ${customFields.libVersion}; objects: .clickable"
			>
			</a-camera>

			<a-entity id="marker" mindar-image-target="targetIndex: 0">
				<a-gltf-model
					class="clickable"
					id="skeleton"
					rotation="0 0 0 "
					position="0 -0.2 -1"
					scale="0.5 0.5 0.5"
					src="#skelly"
					ammo-body="type: dynamic; emitCollisionEvents: true;"
					ammo-shape="type: box; fit: manual; halfExtents: 0.5 1 0.5;"
					skeleton-click
				>
				</a-gltf-model>

				<a-entity id="temp-skeleton"> </a-entity>
				<a-plane
					class="clickable"
					scale="30 30 30"
					color="#00AA00"
					rotation="0 0 0"
					material="opacity: 0.0; transparent: true"
					jump
				></a-plane>
				<a-gltf-model
					id="land2"
					gltf-model="#FlyingLand_2"
					scale="0.4 0.4 0.4"
					position="0 0 -1"
					rotation="0 0 0"
					ammo-body="type: static; emitCollisionEvents: true;"
					ammo-shape="  type: box; fit: manual; halfExtents: 0.5 1 0.5;"
					mesh-model="obj: #FlyingLand_2"
					mesh-model-rendered="true"
					mesh-model-rendered="true"
				>
					>
				</a-gltf-model>

				<!-- Loading bunny model -->
				<!-- <a-entity gltf-model="#bunny" class="clickable" rotation="0 0 0 " position="1 -0.5 0" scale="0.5 0.5 0.5"
                ammo-body="type: dynamic; emitCollisionEvents: true;" enable-physics-on-marker-found
                ></a-entity> -->
				<!--Loading skelly-->
				<!-- <a-gltf-model class="clickable" id="skeleton" src="#skelly" scale="0.5 0.5 0.5" position="0 -0.5 0"
                rotation="0 0 0" ammo-body="type: dynamic ; emitCollisionEvents: true;"
                ammo-shape="  type: box; fit: manual; halfExtents: 0.5 1 0.5;" sprite-jump> -->

				<!-- <a-entity id="model-container" scale="1 -2 1" position="0 0 0" rotation="180 0 0"></a-entity> -->
				<!-- <a-entity id="temp-skeleton" class="clickable" ammo-body="type: dynamic; emitCollisionEvents: true;"
                sprite-jump></a-entity> 
            ammo-body="type: kinematic; emitCollisionEvents: true;"
                ammo-shape="type: box; fit: manual; halfExtents: 2 1 2;"-->

				<!-- <a-gltf-model class="clickable" id="temp-skeleton">

            </a-gltf-model> -->
				<!-- <a-entity class="clickable" id="easter-bunny" gltf-model="#bunny" position="0 0 0" scale="0.4 0.4 0.4"
                bunny-click></a-entity> -->

				<!-- <a-box class="clickable" position="2 1 0" color="red"
                    event-set__click="_event: click; color: blue"></a-box> 
                    event-set__click="_event: click; target: #skeleton;"
                animation__up="property: position; to: 0 0.3 0; dur: 1000; easing: linear; startEvents: click;"
                animation__down="property: position; to: 0 0 0; dur: 1000; easing: linear; startEvents: animationcomplete;"
            
            ammo-body="type: dynamic; emitCollisionEvents: true;"
                ammo-shape="type: box; fit: manual; halfExtents: 0.5 1 0.5;" sprite-jump-->

				<!-- <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"
                    event-set__enter="_event: mouseenter; color: #8FF7FF"
                    event-set__leave="_event: mouseleave; color: #4CC3D9"></a-box> -->
			</a-entity>
		</a-scene>

		<script>
			// // // Define an array with the IDs of the models
			// const modelIds = ['FlyingLand_1', 'FlyingLand_2', 'FlyingLand_3', 'FlyingLand_4', 'FlyingLand_5', 'FlyingLand_6', 'FlyingLand_7'];

			// // Shuffle the array using Fisher-Yates algorithm
			// function shuffle(array) {
			//     for (let i = array.length - 1; i > 0; i--) {
			//         const j = Math.floor(Math.random() * (i + 1));
			//         [array[i], array[j]] = [array[j], array[i]];
			//     }
			//     console.log("Shuffle")
			// }

			// // Display the models in a random order
			// let currentIndex = 0;
			// function displayNextModel() {
			//     //const modelContainer = document.querySelector('#model-container');
			//     const initialModelEl = document.querySelector('#initial-model');
			//     const currentModelId = modelIds[currentIndex];
			//     const currentModel = document.createElement('a-entity');
			//     const initialPosition = initialModelEl.getAttribute('position');
			//     const initialRotation = initialModelEl.getAttribute('rotation');
			//     const initialScale = initialModelEl.getAttribute('scale');
			//     // currentModel.setAttribute('gltf-model', `#${currentModelId}`);
			//     // initialModelEl.appendChild(currentModel);
			//     currentIndex = (currentIndex + 1) % modelIds.length;
			//     const newPosition = {
			//         x: initialPosition.x + 5, // Spawn model 2 units to the right
			//         y: initialPosition.y,
			//         z: initialPosition.z
			//     };

			//     const newRotation = initialRotation;
			//     // Create the new model
			//     const newModelEl = document.createElement('a-entity');
			//     newModelEl.setAttribute('position', newPosition);
			//     newModelEl.setAttribute('rotation', newRotation);
			//     newModelEl.setAttribute('scale', initialScale);
			//     newModelEl.setAttribute('gltf-model', `#${currentModelId}`);
			//     console.log("Load next");
			//     shuffle(modelIds);
			// }

			// // Shuffle the array initially and start displaying the models
			// shuffle(modelIds);
			// displayNextModel();
			// setInterval(displayNextModel, 2000); // Change the model every 5 seconds

			// function spawnModel() {
			//     // Get the position and rotation of the initial model
			//     const initialModelEl = document.querySelector('#initial-model');
			//     const initialPosition = initialModelEl.getAttribute('position');
			//     const initialRotation = initialModelEl.getAttribute('rotation');

			//     // Calculate the position and rotation of the new model
			//     const newPosition = {
			//         x: initialPosition.x + 5, // Spawn model 2 units to the right
			//         y: initialPosition.y,
			//         z: initialPosition.z
			//     };
			//     const newRotation = initialRotation;

			//     shuffle(modelIds);
			//     const currentModelId = modelIds[currentIndex];
			//     // Create the new model
			//     const newModelEl = document.createElement('a-entity');
			//     newModelEl.setAttribute('position', newPosition);
			//     newModelEl.setAttribute('rotation', newRotation);
			//     newModelEl.setAttribute('gltf-model', `#${currentModelId}`);

			//     // Append the new model to the scene
			//     const sceneEl = document.querySelector('a-scene');
			//     sceneEl.appendChild(newModelEl);
			// }

			// // Call the spawnModel function every 2 seconds
			// setInterval(spawnModel, 2000);
		</script>
	</body>
</html>
